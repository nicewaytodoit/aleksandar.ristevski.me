{"componentChunkName":"component---src-templates-post-template-jsx","path":"/posts/2020-10-02---postgresql-installation-ubuntu/","result":{"data":{"site":{"siteMetadata":{"title":"Blog & Profile by Aleksandar Ristevski","subtitle":"Any sufficiently advanced technology is indistinguishable from magic.","copyright":"All rights reserved <br> Copyright Â© 2018 - 2021","author":{"name":"Aleksandar Ristevski","twitter":"@nicewaytodoit"},"disqusShortname":"","siteUrl":"https://nicewaytodoit.github.io/aleksandar.ristevski.me"}},"markdownRemark":{"id":"d011c533-056f-564c-a29a-c7f74969735a","html":"<p>PostgreSQL, also known as Postgres, is a free and open-source relational database management system, which is extensible and SQL compliance. The initial release was 8 July 1996, and the new version 13 was released on 24 Sep 2020. </p>\n<h2>Installation</h2>\n<p>This installation is covering Ubuntu 20.04 and 18.04, which is a very frequent choice for AWS EC2 instances. </p>\n<p>First, we need to check are <code class=\"language-text\">vim</code>, <code class=\"language-text\">bash-completion</code> and <code class=\"language-text\">wget</code> installed and up to date, following downloading and adding <code class=\"language-text\">apt</code> repository keys.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">sudo</span> <span class=\"token function\">apt</span> -y <span class=\"token function\">install</span> <span class=\"token function\">vim</span> bash-completion <span class=\"token function\">wget</span>\n\n$ <span class=\"token function\">wget</span> --quiet -O - https://www.postgresql.org/media/keys/ACCC4CF8.asc <span class=\"token operator\">|</span> <span class=\"token function\">sudo</span> apt-key <span class=\"token function\">add</span> -\n\n$ <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"deb http://apt.postgresql.org/pub/repos/apt/ <span class=\"token variable\"><span class=\"token variable\">`</span>lsb_release -cs<span class=\"token variable\">`</span></span>-pgdg main\"</span> <span class=\"token operator\">|</span><span class=\"token function\">sudo</span> <span class=\"token function\">tee</span>  /etc/apt/sources.list.d/pgdg.list</code></pre></div>\n<p>Next, we need to update the package index, following by PostgreSQL installation. </p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">sudo</span> <span class=\"token function\">apt</span> update\n$ <span class=\"token function\">sudo</span> <span class=\"token function\">apt</span> <span class=\"token function\">install</span> postgresql-13 postgresql-client-13</code></pre></div>\n<p>After the successful installation, we will get a message about the main server configuration settings:</p>\n<blockquote>\n<p>Ver Cluster Port Status Owner    Data directory              Log file\n13  main    5432 down   postgres /var/lib/postgresql/13/main /var/log/postgresql/postgresql-13-main.log</p>\n</blockquote>\n<p>During the installation, PostgreSQL service is started and set to start up after every system reboot.</p>\n<p>We can check service status with the following commands: </p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ systemctl status postgresql.service \n\n$ systemctl status postgresql@13-main.service \n\n$ systemctl is-enabled postgresql\nenabled</code></pre></div>\n<h2>Initial Configuration</h2>\n<p>Ubuntu user <code class=\"language-text\">postgres</code> that has the <code class=\"language-text\">superadmin</code> rights over the entire PostrgreSQL was automatically created during the installation part.\nIt is advisable to change <code class=\"language-text\">postgres</code> database user password immediately after installation by running: </p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> <span class=\"token function\">su</span> - postgres\npsql -c <span class=\"token string\">\"ALTER USER postgres WITH PASSWORD 'P@sswr0d4PostgresUser'\"</span></code></pre></div>\n<p>Optionally we should delete the history line that contains our password change <code class=\"language-text\">history -d 1</code>.</p>\n<p>Then we can run SQL prompt by running:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ psql</code></pre></div>\n<p>Which will display a message similar to the following:</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\">psql <span class=\"token punctuation\">(</span><span class=\"token number\">13.0</span> <span class=\"token punctuation\">(</span>Ubuntu <span class=\"token number\">13.0</span><span class=\"token operator\">-</span><span class=\"token number\">1.</span>pgdg18<span class=\"token punctuation\">.</span><span class=\"token number\">04</span><span class=\"token operator\">+</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">Type</span> <span class=\"token string\">\"help\"</span> <span class=\"token keyword\">for</span> help<span class=\"token punctuation\">.</span>\n\npostgres<span class=\"token operator\">=</span><span class=\"token comment\">#</span></code></pre></div>\n<h3>Create DB and user for DB</h3>\n<p>To get connection details, type the following:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token assign-left variable\">postgres</span><span class=\"token operator\">=</span><span class=\"token comment\"># \\conninfo</span>\n\nYou are connected to database <span class=\"token string\">\"postgres\"</span> as user <span class=\"token string\">\"postgres\"</span> via socket <span class=\"token keyword\">in</span> <span class=\"token string\">\"/var/run/postgresql\"</span> at port <span class=\"token string\">\"5432\"</span><span class=\"token builtin class-name\">.</span></code></pre></div>\n<p>Create a new database by typing:</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\">postgres<span class=\"token operator\">=</span><span class=\"token comment\"># CREATE DATABASE dbexample;</span>\n<span class=\"token comment\">-- CREATE DATABASE</span></code></pre></div>\n<p>Create a new user we can use coupled with the example database we just created above.</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\">postgres<span class=\"token operator\">=</span><span class=\"token comment\"># CREATE USER exampleuser WITH ENCRYPTED PASSWORD 'MyExampl3UserPass';</span>\n<span class=\"token comment\">-- CREATE ROLE</span></code></pre></div>\n<p>Next, we will grant all privileges on the example database to the newly created user. The original <code class=\"language-text\">postgres</code> user already has ownership and supper admin rights on all databases, so this new user we can fine-tune to the database needs.  </p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\">postgres<span class=\"token operator\">=</span><span class=\"token comment\"># GRANT ALL PRIVILEGES ON DATABASE dbexample to exampleuser;</span>\n<span class=\"token comment\">-- GRANT</span></code></pre></div>\n<h3>List all databases</h3>\n<p>While in prompt type command <code class=\"language-text\">\\l</code></p>\n<div class=\"gatsby-highlight\" data-language=\"prompt\"><pre class=\"language-prompt\"><code class=\"language-prompt\">postgres=# \\l\n                               List of databases\n   Name    |  Owner   | Encoding | Collate |  Ctype  |    Access privileges    \n-----------+----------+----------+---------+---------+-------------------------\n dbexample | postgres | UTF8     | C.UTF-8 | C.UTF-8 | =Tc/postgres           +\n           |          |          |         |         | postgres=CTc/postgres  +\n           |          |          |         |         | exampleuser=CTc/postgres\n postgres  | postgres | UTF8     | C.UTF-8 | C.UTF-8 | </code></pre></div>\n<h3>Connect to Database</h3>\n<p>A connection with the database will be established with the default <code class=\"language-text\">postgres</code> user by executing the following command.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">postgres-# \\c dbexample\nYou are now connected to database &quot;dbexample&quot; as user &quot;postgres&quot;.</code></pre></div>\n<p>If we want to connect with a different user we can type:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">postgres-# \\c dbname username</code></pre></div>\n<p>Connect has a following signature:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">\\c or \\connect [ -reuse-previous=on|off ] [ dbname [ username ] [ host ] [ port ] | conninfo ]</code></pre></div>\n<h3>Few additional commands that may be useful to know</h3>\n<table>\n<thead>\n<tr>\n<th>Commands</th>\n<th>description</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>\\d <strong>=table=</strong></td>\n<td>Show table definition including triggers</td>\n</tr>\n<tr>\n<td>\\dn</td>\n<td>Listar Schemas</td>\n</tr>\n<tr>\n<td>\\df</td>\n<td>List functions</td>\n</tr>\n<tr>\n<td>\\dv</td>\n<td>List views</td>\n</tr>\n<tr>\n<td>\\df+ <strong>=function=</strong></td>\n<td>Show function SQL code</td>\n</tr>\n<tr>\n<td>\\x</td>\n<td>Pretty-format</td>\n</tr>\n</tbody>\n</table>\n<p>To learn more, check the official documentation <a href=\"https://www.postgresql.org/docs/13/app-psql.html\">here</a>.</p>\n<h3>Quitting PSQL prompt</h3>\n<p>Lastly, to quit prompt use the following:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">postgres-# \\q</code></pre></div>\n<h3>Linux equivalent commands</h3>\n<p>It is possible to achieve the above without using <code class=\"language-text\">psql</code> prompt by using equivalent shell commands:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">postgres@ubuntu:~$ createuser exampleuser --password\npostgres@ubuntu:~$ createdb dbexample -O exampleuser\npostgres@ubuntu:~$ psql -l </code></pre></div>\n<h2>Connecting to remote PostgreSQL from local machine (Win/Linux)</h2>\n<p>Frequent solution to connect to PostgreSQL database is to allow remote server by editing config file: </p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">sudo</span> <span class=\"token function\">nano</span> /etc/postgresql/13/main/postgresql.conf </code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"conf\"><pre class=\"language-conf\"><code class=\"language-conf\"># Listen on all interfaces\nlisten_addresses = &#39;*&#39;\n\n# Listen on specified private IP address\nlisten_addresses = &#39;192.168.10.11&#39;</code></pre></div>\n<p>After config has been changed, we will need to restart PostgreSQL service:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> systemctl restart postgresql</code></pre></div>\n<p>At the end we need to check whether service listening on appropriate ports:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">netstat</span>  -tunelp <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> <span class=\"token number\">5432</span>\n\ntcp   <span class=\"token number\">0</span>   <span class=\"token number\">0</span>   <span class=\"token number\">0.0</span>.0.0:5432   <span class=\"token number\">0.0</span>.0.0:*   LISTEN  <span class=\"token number\">111</span>  <span class=\"token number\">112837</span>  <span class=\"token number\">11143</span>/postgres      \ntcp6  <span class=\"token number\">0</span>   <span class=\"token number\">0</span>   :::5432        :::*        LISTEN  <span class=\"token number\">111</span>  <span class=\"token number\">112838</span>  <span class=\"token number\">11143</span>/postgres   </code></pre></div>\n<h2>PuTTY tunnel to EC2 PostgreSQL</h2>\n<p>Another way is to connect from the local machine to the remote server by creating SSH tunnel. Using PuTTY, we can create the local port bridging to the remote server and then use the local pgAdmin to manage the serverâs database. </p>\n<h3>PuTTY / SSH</h3>\n<p>In PuTTYâs configuration screen go to:</p>\n<blockquote>\n<p>Connection > SSH > Tunnels > Add new forwarded port:</p>\n</blockquote>\n<p>For <code class=\"language-text\">Source port</code> enter 15432 (or any other available port in your local)\nand for <code class=\"language-text\">Destination</code> enter localhost:5432 (if 5432 port is the PostgreSQL port defined on your remote server).</p>\n<p>Click <code class=\"language-text\">ADD</code> and record will be added to <code class=\"language-text\">Forwarded ports:</code> list.</p>\n<p>Make sure that settings below destination are <code class=\"language-text\">local</code> and <code class=\"language-text\">auto</code>.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 904px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e1fefe72a3ef03ce7ff5c19b07761646/469a4/putty-psql-tunnel.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 93.75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAATABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAIBBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAe03ACKCQf/EABkQAAIDAQAAAAAAAAAAAAAAABBBAAERIf/aAAgBAQABBQJdCGyx/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAwEBPwEf/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAgEBPwEf/8QAFBABAAAAAAAAAAAAAAAAAAAAMP/aAAgBAQAGPwIf/8QAHRABAQACAQUAAAAAAAAAAAAAAQARIRAxQWFxof/aAAgBAQABPyE0vDiF2+89XuMnGX2TqFv/2gAMAwEAAgADAAAAEJMIPP/EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQMBAT8QH//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQIBAT8QH//EABsQAQADAAMBAAAAAAAAAAAAAAEAESExQWGB/9oACAEBAAE/ENoNoM6Jv5FxofSWqOfcFW3m29xHLW/W5y7AmjyxQ29s/9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"SSH Tunnel to PostgreSQL\"\n        title=\"SSH Tunnel to PostgreSQL\"\n        src=\"/static/e1fefe72a3ef03ce7ff5c19b07761646/469a4/putty-psql-tunnel.jpg\"\n        srcset=\"/static/e1fefe72a3ef03ce7ff5c19b07761646/09b79/putty-psql-tunnel.jpg 240w,\n/static/e1fefe72a3ef03ce7ff5c19b07761646/7cc5e/putty-psql-tunnel.jpg 480w,\n/static/e1fefe72a3ef03ce7ff5c19b07761646/469a4/putty-psql-tunnel.jpg 904w\"\n        sizes=\"(max-width: 904px) 100vw, 904px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Go back to PuTTY <code class=\"language-text\">Session</code>, load your server details and click <code class=\"language-text\">Open</code>.</p>\n<h3>pgAdmin 4 connecting from client to remote server</h3>\n<p>Now only left is to open pgAdmin (4) go to tree root <code class=\"language-text\">Servers</code> right click and choose:</p>\n<blockquote>\n<p><code class=\"language-text\">Create &gt; Server...</code></p>\n</blockquote>\n<p>In the <code class=\"language-text\">General</code> tab choose name for the server connection <code class=\"language-text\">MyRemoteEC2Server</code>, choose group, and switch to <code class=\"language-text\">Connection</code> tab.</p>\n<p>In <code class=\"language-text\">Connection</code> tab populate for:</p>\n<ul>\n<li><strong>Host name/address:</strong> localhost</li>\n<li><strong>Port</strong>: 15432 *(this is a âbridgeâ port we created earlier with PuTTY)</li>\n<li><strong>Maintenance database</strong>: dbexample</li>\n<li><strong>Username</strong>: exampleuser</li>\n<li><strong>Password</strong>: <em>ThatUs3rP@ssw0rd</em></li>\n</ul>\n<p>Be careful with what user you connecting as it can have limited permissions, so from time to time, for a database backup and restore purposes you will need to connect with:</p>\n<ul>\n<li><strong>Maintenance database:</strong> postgres</li>\n<li><strong>Username</strong>: postgres</li>\n</ul>","fields":{"tagSlugs":["/tags/postgre-sql/","/tags/linux/","/tags/ubuntu/","/tags/installation/"]},"timeToRead":6,"frontmatter":{"title":"PostgreSQL v13 Installation on Ubuntu 18.04","tags":["PostgreSQL","Linux","Ubuntu","Installation"],"date":"2020-10-02T07:13:30.000Z","description":"This is a walkthrough on how to install and configure basic PostgreSQL on Linux and create a local remote connection with the EC2 PostgreSQL server."}}},"pageContext":{"slug":"/posts/2020-10-02---postgresql-installation-ubuntu/"}},"staticQueryHashes":[]}